# VibeCoding 安全开发守则

> 这是一份"活的"开发前检查清单。
> 在你开始写新的功能、或是每次 `git commit` 之前，花 30 秒快速浏览一遍。
> 目标：将安全内化为直觉，从源头避免灾难。

---

### ⭐ 金科玉律

- [ ] **【绝不写死秘密】** 任何密码、API 金钥、数据库连线信息，都**绝不**能直接写在程序代码里 (无论前端或后端)。
- [ ] **【使用环境变量】** 所有敏感信息都必须透过**环境变量** (`.env` 文件) 来管理。
- [ ] **【忽略秘密文件】** `.env` 文件**永远**要被加入到 `.gitignore` 中，绝不能上传到 GitHub。
- [ ] **【预设不信任】** **绝不**信任任何来自使用者的输入 (包括表单、URL 参数、API 请求内容、上传的文件)。

---

### 📥 处理使用者输入

- [ ] **【防止注入攻击】** 所有数据库查询**必须**使用**参数化查询 (Parameterized Queries)** 或 ORM 提供的安全方法，严禁手动拼接 SQL 字符串。
- [ ] **【防止 XSS】** 所有要显示在 HTML 页面上的使用者内容，都**必须**经过 HTML 实体编码 (HTML Escaping) 处理。
- [ ] **【验证文件上传】** 检查使用者上传的文件：
    - [ ] **验证副档名**：只允许白名单中的文件类型 (例如 `['jpg', 'png', 'pdf']`)。
    - [ ] **验证文件大小**：设定合理的上限。
    - [ ] **储存位置**：上传的文件应储存在**非公开**且**不可执行**的目录。

---

### 🔐 权限与认证

- [ ] **【API 端点保护】** 每个需要登录才能存取的 API 端点，都**必须**在程序一开始就检查用户的登录状态和权限。
- [ ] **【最小权限原则】** 数据库帐号、API 金钥的权限都应该是「最小可用」的。如果只需要读取，就绝不给予写入权限。
- [ ] **【安全的 Session】** Session ID 应设定为 `HttpOnly` 和 `Secure` 旗标，防止被窃取和在不安全的连线中传输。

---

### ☁️ 外部服务与云端整合

- [ ] **【外部数据库防火墙】** 连接外部数据库 (如 AWS RDS, MongoDB Atlas) 时，**必须**在其防火墙/安全群组中设定规则，只允许来自你应用程序服务器的特定 IP 位址连线。**严禁**对 `0.0.0.0/0` (全世界) 开放。
- [ ] **【云端储存私有化】** 所有云端储存空间 (如 AWS S3, Google Cloud Storage) 的储存桶 (Bucket)，预设**必须**设定为**私有 (Private)**。
- [ ] **【使用预签章 URL】** 当需要让用户临时存取私有文件时，应使用有短时效的**预签章 URL (Pre-signed URL)**，而不是将文件设为公开。
- [ ] **【验证 Webhook】** 当接收来自第三方服务 (如 Stripe, GitHub) 的 Webhook 时，**必须**使用对方提供的密钥来**验证请求的签章 (Signature)**，确保请求来源合法。
- [ ] **【CORS 严格设定】** API 的 CORS (跨来源资源共用) 策略，**必须**明确指定允许的前端网域。**严禁**在生产环境中使用万用字元 `*`。
- [ ] **【API 金钥权限最小化】** 在申请第三方服务 (如 Google Maps) 的 API 金钥时，务必在该服务的后台设定最严格的限制（例如：限制只能从你的网站网域发起请求，限制只能调用特定 API）。

---

### ⚙️ 文件与服务器设定

- [ ] **【绝不用 777】** 服务器上的任何文件或目录，**绝不**使用 `777` 权限。目录预设 `755`，文件 `644`。
- [ ] **【保护设定档】** 敏感设定档 (`config.php`, `.env`) 权限应设为 `600` 或更严格。
- [ ] **【禁止下载关键文件】** 确认 Web 服务器 (Nginx/Apache) 已设定规则，禁止外部直接存取 `.env`, `.git`, `.htaccess` 等敏感文件与目录。
- [ ] **【关闭侦错模式】** 在上线环境中，**必须**关闭所有框架或语言的侦错模式 (Debug Mode)，避免泄漏详细的错误讯息。

---

> ### **🤖 给 AI 助理的提示**
>
> **当你与开发者的对话中，侦测到他正在或计画要连接任何「外部服务」（例如：云端数据库、第三方支付API、文件储存S3、验证服务等）时，请你务必主动、清晰地提出以下问题，以引导他进行安全思考：**
>
> 1.  **「关于这个 [服务名称]，我们是否已经设定了最严格的防火墙/IP白名单规则？」**
> 2.  **「我们准备使用的 API 金钥，权限是否已经在该服务的后台限制在最小必需范围内？」**
> 3.  **「对于这个外部服务，我们是否有应对其服务中断或被骇时的降级计画（例如：暂时关闭相关功能、显示维护讯息）？」**